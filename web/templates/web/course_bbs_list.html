{% extends "base.html" %}

{%block css%}
{% endblock %}


{% block content %}

    <div style="background-color: #cacdfa; padding-bottom: 15px; margin: 5px">
        <div style="padding: 15px;padding-left: 30px; font-size: 200%;">
            {{ course.C_Name }}
            {% if isLike %}
            <input id="likecou" type="button" class="btn btn-default likeBtn blue mybutton" style="margin-left: 100px" value="已收藏" onclick="javascript:likecourse(this)">
            {% else %}
            <input id="likecou" type="button" class="btn btn-default likeBtn blue mybutton" style="margin-left: 100px" value="收藏" onclick="javascript:likecourse(this)">
            {% endif %}
        </div>
        <div style="padding-left: 30px;">开课教师：</div>
        <div style="padding-left: 30px;">课程介绍：</div>
        <div style="padding-left: 30px;">课程任务：</div>
        <div style="padding-left: 30px;">考核方式：</div>
    </div>

    <div style="background-color: white; margin: 5px; padding: 15px">
        <div style="display: inline-block; font-size: 300%; padding-left: 30px">
            {{ course.C_Rank }}
        </div>
        <div style="display: inline-block;">
            <div>
                <div style="display: inline-block">
                    分
                </div>
                <div style="display: inline-block; padding-left: 100px">
                    {{ course.C_Ranknum }}个用户已评
                </div>
            </div>
            <div style="padding-left: 100px">
                查看全部历史评分
            </div>
        </div>
    </div>


    {% if isHaving == 1 %}
<a class="fatie" href="/post/{{ course.id }}">发帖</a>
    {% endif %}

<div style="background-color: #cacdfa">
    <div style="padding: 5px; text-align: center; font-size:200%">评论留言区</div>
</div>





{% for post in posts %}
    <div onclick="window.location.href='/course/{{ course.id }}/post/{{ post.id }}'" style="margin: 10px; background-color: white">
        <div class="media">
            <div class="media-left">
                <img class="media-object" src="{{BASE_DIR}}/media/{{post.P_User.U_Image}}" width="60" height="60"/>
                <div style="text-align: center">
                    {{ post.P_User.U_name}}
                </div>
            </div>
            <div class="media-body" style="padding-top: 10px">
                {{ post.P_Content }}
                {% if post.P_User == user%}
                    <button id="{{ post.id }}" class="button2" data-toggle="modal" data-target="#myModal" onclick="javascript:deletepost(this)">删除</button>
                {% endif %}
            </div>
        </div>
        <div style="color: #909090; padding-left: 60%">
            互动 {{ post.P_ReplyNum }} 赞 {{ post.P_LikeNum }}
        </div>
    </div>
{% empty %}
    <li>抱歉，目前还没有帖子。</li>
{% endfor %}

    <!-- 模态框（Modal） -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
   aria-labelledby="myModalLabel" aria-hidden="true">
   <div class="modal-dialog">
      <div class="modal-content">
         <div class="modal-header">
            <button type="button" class="close"
               data-dismiss="modal" aria-hidden="true">
                  &times;
            </button>
            <h4 class="modal-title" id="myModalLabel">
               确认
            </h4>
         </div>
         <div class="modal-body">

              删除

         </div>
         <div class="modal-footer">

             <a id="deleteid" href="/">确认删除</a>
            <button type="button" class="btn btn-default"
               data-dismiss="modal">取消
            </button>
         </div>
      </div><!-- /.modal-content -->
</div><!-- /.modal -->
</div>

    <script type="text/javascript">

    function deletepost(obj){
        idstr = obj.id
        deletedom = document.getElementById("deleteid")
        cid = {{ course.id }}
        restr = "/course/"+cid+"/delete_post/"+idstr+"/"
        deletedom.setAttribute("href",restr)
    }

    $(function () {
        {% for post in posts  %}
            var s = '{{ post.P_Content|safe }}'
            p = s.match(/__url_start__(\S*?)__url_end__/)
            while (!(p === null)) {
                s = s.replace(p[0], "<img src='{{BASE_DIR}}/media/" + p[1] + "' />")
                p = s.match(/__url_start__(\S*?)__url_end__/)
            }
        $('#content_{{ post.id }}').html(s)
        {% endfor %}
    });

    function likecourse(obj)
    {
        console.log(obj)
        courseid = {{ course.id }}
        $.ajax
        ({
            url: '/like_course/',
            type: 'POST',
            data: {'courseID': courseid},
            success: function(data) {

                if (obj.value == '已收藏') {
                    obj.value = '收藏';
                }
                else {
                    obj.value = '已收藏';
                }
            }
        })
    }
    </script>
{% endblock %}