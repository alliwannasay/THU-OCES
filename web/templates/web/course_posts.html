{% extends "base.html" %}

{%block css%}
{% endblock %}


{% block content %}



    {% if isHaving == 1 %}
<a class="fatie" href="/post/{{ course.id }}">发帖</a>
    {% endif %}


<div style="background-color: #cacdfa">
    <div style="padding: 5px; text-align: center; font-size:200%">精选</div>
</div>


{% for likepB in likepBs %}
    <div onclick="window.location.href='/course/{{ course.id }}/post/{{ likepB.post.id }}'" style="margin: 10px; background-color: white">
        <div class="media">
            <div class="media-left">
                <img class="media-object" src="{{BASE_DIR}}/media/{{likepB.post.P_User.U_Image}}" width="60" height="60"/>
                <div style="text-align: center">
                    {{ likepB.post.P_User.U_name}}
                </div>
            </div>

            {% if likepB.rank != -1 %}
            <div class="media-body" style="padding-top: 10px">
                {{ likepB.rank }}分
            </div>
            {% endif %}


            <div class="media-body" style="padding-top: 10px">
                {{ likepB.post.P_Content }}
            </div>
        </div>
        <div style="color: #909090; padding-left: 60%">
            互动 {{ likepB.post.P_ReplyNum }} 赞 {{ likepB.post.P_LikeNum }} 踩 {{ likepB.post.P_DislikeNum }} <a href="/report/{{ likepB.post.id }}/">举报</a>
        </div>
    </div>
                {% if likepB.post.P_User == user%}
                    <button id="{{ likepB.post.id }}" class="button2" onclick="javascript:deletepost(this)">删除</button>
                {% endif %}
{% empty %}
    <li>抱歉，目前还没有帖子。</li>
{% endfor %}


    <div style="background-color: #cacdfa">
    <div style="padding: 5px; text-align: center; font-size:200%">最新</div>
</div>


{% for timepB in timepBs %}
    <div onclick="window.location.href='/course/{{ course.id }}/post/{{ timepB.post.id }}'" style="margin: 10px; background-color: white">
        <div class="media">
            <div class="media-left">
                <img class="media-object" src="{{BASE_DIR}}/media/{{timepB.post.P_User.U_Image}}" width="60" height="60"/>
                <div style="text-align: center">
                    {{ timepB.post.P_User.U_name}}
                </div>
            </div>

            {% if timepB.rank != -1 %}
            <div class="media-body" style="padding-top: 10px">
                {{ timepB.rank }}分
            </div>
            {% endif %}


            <div class="media-body" style="padding-top: 10px">
                {{ timepB.post.P_Content }}
            </div>
        </div>
        <div style="color: #909090; padding-left: 60%">
            互动 {{ timepB.post.P_ReplyNum }} 赞 {{ timepB.post.P_LikeNum }} 踩 {{ timepB.post.P_DislikeNum }} <a href="/report/{{ likepB.post.id }}/">举报</a>
        </div>
    </div>
                {% if timepB.post.P_User == user%}
                    <button id="{{ timepB.post.id }}" class="button2" onclick="javascript:deletepost(this)">删除</button>
                {% endif %}
{% empty %}
    <li>抱歉，目前还没有帖子。</li>
{% endfor %}


    <script type="text/javascript">

    function deletepost(obj){

        idstr = obj.id
        deletedom = document.getElementById("deleteid")
        cid = {{ course.id }}

        restr = "/course/"+cid+"/delete_post/"+idstr+"/"
        alert("确定删除？")
        window.location.href = restr

    }

{#    $(function () {#}
{#        {% for likepB in likepBs  %}#}
{#            var s = '{{ likepB.post.P_Content|safe }}'#}
{#            p = s.match(/__url_start__(\S*?)__url_end__/)#}
{#            while (!(p === null)) {#}
{#                s = s.replace(p[0], "<img src='{{BASE_DIR}}/media/" + p[1] + "' />")#}
{#                p = s.match(/__url_start__(\S*?)__url_end__/)#}
{#            }#}
{#        $('#content_{{ likepB.post.id }}').html(s)#}
{#        {% endfor %}#}
{#    });#}


    </script>
{% endblock %}

